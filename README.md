# Хакатон Лента: Сентябрь 2023
**Задача хакатона:** Создать алгоритм прогнозирования спроса конкретного товара в конкретном магазине сети супермаркетов Лента

**Задача команды DS:** Проанализировать данные, сделать предобработку данных, обучить модель машинного обучения и проверить её качество.

# Содержание репозитория:

## 1. [Блокнот с исследовательским анализом данных](EDA.ipynb)
Проведенн EDA. Было принято решение выделить несколько групп товаров и магазинов и прогнозировать спрос уже для них.

## 2. [Блокнот с предобработкой данных](Preprocessing.ipynb)
В данной работе проведена предобработка данных с учетом особенностей выявленных при исследовательском анализе

## 3. [Блокнот с моделингом](Modeling.ipynb)
Были разработаны модели, согласно стратегии выбранной в EDA. Совершён подбор параметров для генерации фичей, выбраны наиболее важные признаки, подобрана наиболее подходящая модель 
(в данном случае её оказался Catboost)

## 4. [Файл для получения прогноза](predict.py)
Содержит скрипт, который позволяет полчить прогноз для товаров и магазинов из файла запроса sales_submission.csv. Для корректной работы скрипта необходимо, чтобы в директории со скриптом находились:
- [папка models](models) с обученными моделями;
- папка data содержащая в себе:
	* файл holidays.csv с праздниками на 2022, 2023 год
	* папка row с сырыми данными, содержащая файлы
		- sales_df_train.csv –данные по продажам за скользящий год для обучения;
		- pr_df.csv – данные по товарной иерархии;
		- st_st.csv – данные по магазинам;
		- sales_submission.csv - файл с запросом о том по каким товарам и магазинам на какую дату нужен прогноз.
	* папка submission для сохранения прогноза 
	
*p.s. Скрипт преобразует сырые данные в формат, необходимы для прогноза, поэтому работает продолжительное время*

	
## 5. [Папка для развёртывания докера](for_docker)
Папка содержащая Docker файл для развёртывания приложения и необходимые скрипты. Приложение работает на FastAPI, раз в сутки получает данные от бэкэнда, делает прогноз и по запросу
возвращает прогноз на 14 дней вперёд. Для функционирования приложения перед сборкой скопировать папку data с сырыми данными в папку src (содержание папки аналогично описанному выше 
за исключением папки submitions, её копировать не надо)

В корне папки находится файл *config.yaml* в нём можно изменить пути до соответствующих файлов, а также задать IP для ответа бэку после окончания обучения.

Приложение имеет следующие ручки:
* /api/v1/health - возвращает статус ok если приложение развёрнуто и исправно работает
* /api/v1/get_last_date - возвращает дату последней записи в данных о покупках
* /api/v1/update_sales - принимает новые данные о покупках, проводит прогноз на 14 дней вперёд от последней даты и записывает информацию в файл сабмита и отправляет сообщение на бэкэед об окончании обработки
* /api/v1/get_predict' - возвращает последний сделанный прогноз
